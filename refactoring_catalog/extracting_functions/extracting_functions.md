# 関数の抽出

## 例

```typeScript
const printOwing = (invoice: Invoice) => {
    printBanner();
    let outstanding = calculateOutstanding();

    // 明細の印字 (print details)
    console.log(`name: ${invoice.customer}`);
    console.log(`amount: ${outstanding}`);
}
```

**⇩**

```typeScript
const printOwing = (invoice: Invoice) => {
    printBanner();
    let outstanding = calculateOutstanding();
    printDetails(outstanding)

    const printDetails = (outstanding: number) => {
        console.log(`name: ${invoice.customer}`);
        console.log(`amount: ${outstanding}`);
    };
}
```

## 動機

**頻繁に行われるリファクタリグ**

### 「何」をしているかを示す名前の関数として抽出すべき

関数名を読み返すだけで関数の目的がすぐ伝わる。

小さい関数は名前が良くないと意味がない。

## 手順

### ① 新たな関数を作り、その意図に沿って命名する（どうするかではなく、何をするかによって名づける）

- 抽出したいコードがごく単純な場合であっても、新しい関数名がコードの意図をより適切に表現するのであれば抽出する。

- 抽出した関数を元の関数内に入れ子にする。
  - ③ で扱うスコープ外の変数を大幅に減らすことができる。あとからいつでも「関数の移動」が行える

### ② 抽出したいコードを、元の関数から新たな関数にコピーする

### ③ 抽出したいコードを調べて、元の関数ではスコープ内だったが抽出後の関数ではスコープ外になった関数を特定する。それらをパラメータとして渡す。

- 抽出した関数を元の関数の入れ子として定義すると、③ は不要

- 抽出したコード内で代入されるローカル変数が多い場合は、一旦抽出は諦めた方が良い
  - その場合「変数の分離」「問い合わせによる一時変数の置き換え」といったリファクタリングで変数の使い方を整理してから抽出に取り組む

### ④ 全ての変数を処理したらコンパイルする

- 正しく処理できていなかった変数を見つけるのに役立つことがある

### ⑤ 元の関数に残った抽出前のコードを、抽出された関数への呼び出しに置き換える

### ⑥ テストする

### ⑦ 残りのコードを見て、抽出したコードと同じまたは類似したコードを探し、「関数呼び出しによるインラインコードの置き換え」を適用し、新しい関数を呼ぶ形にできないかを検討する

- 重複したコードが他にないかを軽く探してみると良い
