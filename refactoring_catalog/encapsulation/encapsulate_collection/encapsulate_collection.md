# コレクションのカプセル化

## 例

```typeScript

class Person {
    get courses() {
        return this._courses;
    }

    set courses(aList) {
        this._courses = aList;
    }
}

```

**⇩**

```typeScript

class Person {
    get courses() {
        return this._courses.slice();
    }

    addCourse(aCourse) {
        ...
    }

    removeCourse(aCourse) {
        ...
    }
}

```

## 動機

コレクションの変数へのアクセスはカプセル化されていても、getter でコレクションそのものを返してしまうと、コレクションを保持するクラスを介さずに、その中身を変更できてしまう。

↑ 対応

**コレクションの内容を変更するメソッドをクラスに用意する**

コレクションの変更を防ぐ方法

- コレクションを返さない
  - コレクションのフィールドを使う時には必ず、そのクラスの特定のメソッドを通じて行う。
- コレクションに対して読み取り専用のアクセサを許す。
- コレクションの取得メソッドを用意し、それにコレクションのコピーを返させる
  - 一般的

## 手順

### ① コレクションの参照がまだカプセル化されていないなら「変数のカプセル化」を施す。

### ② 要素を追加・削除するための関数をコレクションに追加する

- コレクションの setter がある場合、可能であれば「setter の削除」を施す。それが不可能ならコレクションのコピーを返すようにする

### ③ 静的チェックを実行する

### ④ 全てのコレクションの参照を探す。コレクションの変更メソッドをよんでいる場合は、新たな追加・削除のメソッドを使うように変更。変更のたびにテスト

### ⑤ コレクションの getter を変更して、保護されたビュー（読み取り専用プロキシまたはコピー）を返すようにする

### ⑥ テストする
